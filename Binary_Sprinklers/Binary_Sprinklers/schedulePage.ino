char * schedulePage() {
  char * page = R"page(<meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="stylesheet" type="text/css" href="stylesheet.css"> <html> <div id=saving style="position:fixed;top:0;bottom:0;left:0;right:0;text-align:center;font-size:3rem;background:rgba(150,150,150,.5);display:none"> <div class=popout> Saving Data Please Wait</div> </div> <div id=save style=text-align:center> <button onclick=save()>Save Changes</button> <div style=font-size:.75rem;> <br>Click Column Heads to Sort Column <br>Click Day Column to Select Run Days </div> </div> <div id=ss></div> <div class=popout id=dayMenu style=display:none;> <div id=dayInputMenu></div> <button onmousedown=setup() onclick=dayMenu.style.display="none";>Save</button> <button onclick=dayMenu.style.display="none";>Cancel</button> </div> <div  style=text-align:center><button onclick=addTime()>Add Time</button></div> </html> <script> modified=0; wdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]; if (schedule==undefined){ schedule=[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]; } setup(); function qs(s){ return Array.from(...Array(document.querySelectorAll(s))); } function save(){ modified=0; var names=["days","zone","start","runtime"]; for (var pos in schedule){ var m="id=schedule&pos="+pos; for (var val=0;val<4;val++){ m+="&"+names[val]+"="+schedule[pos][val]; } var r=new XMLHttpRequest(); r.open("POST","saveData.html",true); r.setRequestHeader('Content-type', 'application/x-www-form-urlencoded'); r.send(m); } var d=new XMLHttpRequest(); d.open("POST","saveData.html",true); d.setRequestHeader('Content-type', 'application/x-www-form-urlencoded'); d.onreadystatechange = function() { if (this.readyState == 4 && this.status == 200) { alert(this.responseText); saving.style.display="none"; } }; d.send("id=scheduleDone"); saving.style.display=""; } function getMTime(T){ hour=parseInt(T/60,10); minutes=T%60; return [hour,minutes] } function getTime(h,m){ console.log(arguments); if (m != undefined){ return hour*60+m; }else{ var ampm=""; hour=parseInt(h/60,10); minutes=h%60; if (hour > 11) { ampm="PM"; }else{ ampm="AM"; } if (hour%12==0){ hour=12; }else{ hour=hour%12; } return [hour,minutes,ampm]; } } function updateDays(ele,pos){ modified=1; if (ele.dataset.value=="1"){ ele.style.background="red"; ele.style.color="black"; ele.innerText=String.fromCharCode(10008); ele.dataset.value=0; }else{ ele.dataset.value=1; ele.style.background="green"; ele.style.color="white"; ele.innerText=String.fromCharCode(10004); } val=parseInt(qs("."+ele.className).map(function(ele){if(ele.dataset.value=="1")return 1;else return 0;}).join(""),2); schedule[pos][0]=val; } function dayInput(days,pos){ days=String(days); console.log(days); var v="<table style=width:20vw;font-size:1.5rem;><tr>"; for (var x=0;x<7;x++){ v+='<td onclick=updateDays(this,'+pos+') class=p'+pos; if (days[x]=="1"){ v+=' data-value=1 style="font-size:1.5rem;cursor:pointer;color:white;background:green;border:black solid 1px">&#10004'; }else{ v+=' data-value=0 style="font-size:1.5rem;cursor:pointer;color:black;background:red;border:black solid 1px">&#10008'; } v+="</td><td>"+wdays[x]+"</td></tr>"; } v+="</table>"; return v; } function zoneInput(val,pos){ var t="<select data-value="+pos+" onchange=update(this)>"; for (var x=0;x<zones.length;x++){ t+="<option value="+x+" "; if (val == x){ t+="selected"; } t+=">"+zones[x]+"</input>"; } t+="</select>"; return t; } function remove(x){ schedule[x]=[0,0,0,0]; setup(); } function addTime(){ for (var x in schedule){ if (schedule[x][0]==0){ schedule[x][1]=0; schedule[x][2]=0; schedule[x][3]=0; schedule[x][0]=127; schedule.sort((a,b)=>{if(b[3]==0) return -1}); setup(); return; } } alert("All slots are occupied! Delete a schedule point to make space!"); } function update(ele){ modified=1; pos=ele.dataset.value; if (ele.type=="select-one"){ schedule[pos][1]=Number(ele.value); }else if(ele.type=="time"){ var val=ele.value.split(":"); schedule[pos][2]=(Number(val[0])*60)+Number(val[1]); }else if(ele.type=="number"){ schedule[pos][3]=Number(ele.value); } } function mysort(ele){ var col=ele.cellIndex; var vals=[]; var n=0; for (x in schedule){ if (schedule[x][0] && schedule[x][3]){ vals[n]=[schedule[x][col],n]; n++; } } return vals; } function colSort(ele,rev=0){ if (ele.className.indexOf("sorted")>-1){ rev=1; ele.className=ele.className.replace("sorted","reverse"); }else if(ele.className.indexOf("reverse")>-1){ rev=0; ele.className=ele.className.replace("reverse","sorted"); }else{ for (x in qs(".sorted,.reverse")){ qs[x].className=qs[x].className.replace("sorted",""); qs[x].className=qs[x].className.replace("reverse",""); } ele.className+=" sorted"; } col=ele.cellIndex; if(rev){ schedule.sort((a,b)=>(b[col]-a[col])); }else{ schedule.sort((a,b)=>(a[col]-b[col])); } setup(); } function setup(){ var weekdays="SMTWTFS"; var t='<table class=datatable ><tr><th class="sortable title" onclick=colSort(this,1)>Days</th><th class="sortable title" onclick=colSort(this)>Zone</th><th class="sortable title" onclick=colSort(this)>Time</th><th class="sortable title" onclick=colSort(this)>RunTime</th><th class=title>Action</th></tr>'; for (var x=0;x<schedule.length;x++){ if (!schedule[x][0]){continue;} var days=schedule[x][0].toString(2).padStart(7, '0'); var stringDays=""; for (d in days){ if (days[d]=="1"){ stringDays+="<u><b>"+weekdays[d]+"</u></b>"; }else{ stringDays+=weekdays[d]; } } t+='<tr><td selectable=false style=cursor:pointer onmousedown=dayInputMenu.innerHTML=dayInput("'+days+'",'+x+') onclick=dayMenu.style.display="">'+stringDays+'</td>\ <td>'+zoneInput(schedule[x][1],x)+'</td>\ <td><input data-value='+x+' onchange=update(this) type=time value='+String(getMTime(schedule[x][2])[0]).padStart(2,"0")+':'+String(getMTime(schedule[x][2])[1]).padStart(2,"0")+'></td>\ <td><input data-value='+x+' onchange=update(this) type=number value='+schedule[x][3]+'></td>\ <td>\ <svg data-value='+x+' onclick=remove('+x+') xmlns="http://www.w3.org/2000/svg" height="1.5rem" viewBox="0 0 24 24" width="1.5rem" onclick="remove(this,this.parentElement.parentElement.id)">\ <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"></path>\ <path d="M0 0h24v24H0z" fill="none"></path>\ </svg></td>\ </tr>'; } t+="</table>"; ss.innerHTML=t; } </script>
)page";
  return page;
}

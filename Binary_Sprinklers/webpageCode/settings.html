<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="stylesheet.css">
<html style=text-align:center;>
<div style=text-align:center;font-weight:bold;font-size:1.5rem;>Settings</div>

<div class=divHead>Zone Names</div>
<div id=zoneNamesForm style=text-align:center;></div>
<div class=divHead>Set Password</div>
<button onclick=setPassword.style.display="" >Set Password</button>
<form id=setPassword method=POST class=popout onsubmit=s(this,event) style=display:none >
		<div class=divHead>Password Settings</div>
		Password: <input type=password id=pw1 name=pw1><br>
		Password: <input type=password id=pw2 name=pw2><br>
		Timeout: <input type=number id=timeout name=timeout><br>
	<input type=submit  onclick=this.parentElement.style.display="none" value=Save><button onclick=this.parentElement.style.display="none">Cancel</button>
</form>

<div class=divHead>Wifi Settings</div>
<div style=text-align:center; id=wifi>
<form onsubmit=s(this,event) id="AP"  method=POST>
Access Point Visibility:<select name=visibility><Option value=0>Visible</option><option value=1>Hidden</option></select>
<br>SSID<input type=text name=ssid id=ssid><br>
<input type=submit value=Save>
</form>
</div>

<div class=divHead>Firmware Update</div>
		<form id=Update onsubmit=s(this,event)  method=POST>
				<input type=text placeholder="Update Server" value="jeffshomesite.com" name=source><br>
				<input value=Update type=submit onclick='alert("Device will update and reboot")'>
		</form>

<div class=divHead>Reboot Sprinkler Controller</div>
<form id=reboot onsubmit=s(this,event)>
		<input type=submit value=Reboot>
</form>
<div class=divHead>Erase All Saved Data</div>
		<form id=reset onsubmit=s(this,event) ><input type=submit value="Full Reset">
		</form>

<html>
<script>


function pairEncode(fd){
	fd=Array.from(fd.entries());
	f=fd[0][0]+"="+fd[0][1];
	for (var x=1;x<fd.length;x++){
		f+="&"+fd[x][0]+"="+fd[x][1];
	}
	return f;
}

ssid.value=SSID;
zn();


function s(ele,eve){
	eve.preventDefault();
	if (ele.id=="reset"){
		if (!confirm("This will erase all saved data! Continue?")){
			return false;
		}
	}else if (ele.id=="setPassword"){
			if (pw1.value != pw2.value){
				alert("Passwords Must Match");
				return false;
			}
	}
	fd=new FormData(ele);
	fd.set("id",ele.id);
	data=pairEncode(fd);
	var r=new XMLHttpRequest;
	r.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            alert(this.responseText);
       }
    };
	r.open("POST","saveData.html",true);
	r.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
	r.send(data);
	return false;
}



function zn(){
	var n='<form id=zoneNames onsubmit=s(this,event) action="saveData.html" method=POST>';
	for (var x=1;x<9;x++){
		n+='Zone '+x+': <input type=text name="zone'+x+'" value="'+zones[x-1]+'"><br>';
	}
	n+='<input value=Save type=submit></form>';
	zoneNamesForm.innerHTML=n;
}

</script>
